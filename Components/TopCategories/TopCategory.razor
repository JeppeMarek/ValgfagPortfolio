@page "/topcategory/{id:int}"
@using Microsoft.IdentityModel.Tokens
@rendermode InteractiveServer

@inject ICategoryService CategoryService
@inject IPostService PostService
@if (Category is null)
{
    <MudProgressCircular Indeterminate/>
}
else
{
    <!-- INTRO / HEADER -->
    <MudPaper Class="pa-4 mb-5">
        <MudText Typo="Typo.h4">@Category.Title</MudText>

        @if (!Category.Description.IsNullOrEmpty())
        {
            <MudText Typo="Typo.h5">Om @Category.Title</MudText>
            @if (Category.Description.Length >= 100)
            {
                <MudButton OnClick="@OnExpandCollapseClick">@(isExpanded ? "Læs mindre..." : "Læs mere...")
                </MudButton>
                <MudDivider/>
                <MudCollapse  Expanded="isExpanded">@Category.Description</MudCollapse>
            }
            else
            {
                <MudText
                    Typo="Typo.body1">@(Category.Description.IsNullOrEmpty() ? "" : Category.Description)</MudText>
            }
        }
    </MudPaper>
    
    <!-- MAIN LAYOUT -->
    <MudGrid>
        <!-- CENTER: SUBCATEGORIES -->
        <MudItem xs="12" md="8">
            <MudGrid>
                @foreach (var sub in SubCategories)
                {
                    <MudItem xs="12" sm="6" lg="4">
                        <CategoryComponent SelectedCategory="@sub"></CategoryComponent>
                    </MudItem>
                }
            </MudGrid>
        </MudItem>

        <!-- RIGHT: RECENT POSTS -->
        <MudItem xs="12" md="4">
            <MudPaper Class="pa-4">
                <MudText Typo="Typo.h6">Seneste ændringer</MudText>

                @if (RecentPosts.Any())
                {
                    <MudList Dense="true" T="Post">
                        @foreach (var post in RecentPosts)
                        {
                            <MudListItem Href="@($"/post/{post.Id}")">
                                <MudText Typo="Typo.subtitle2">
                                    @post.Title
                                </MudText>
                                <MudText Typo="Typo.caption">
                                    @post.DateEdited.ToShortDateString()
                                </MudText>
                            </MudListItem>
                        }
                    </MudList>
                }
                else
                {
                    <MudText Typo="Typo.caption" Class="mt-2">
                        Ingen ændringer endnu.
                    </MudText>
                }
            </MudPaper>
        </MudItem>
    </MudGrid>
}
